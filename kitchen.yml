---
verifier:
  name: inspec
provisioner:
  name: chef_solo
  data_bag_path: test/integration/data_bags
  encrypted_data_bag_secret_key_path: test/integration/encrypted_data_bag_secret
  enforce_idempotency: true
  multiple_converge: 2
  deprecations_as_errors: true

suites:
  - name: default
    attributes:
      users:
        - test1-staging
    run_list:
      - recipe[sudo]
      - recipe[osl-app::default]
  - name: app1
    attributes:
      users:
        - test1-staging
    run_list:
      - recipe[sudo]
      - recipe[user::data_bag]
      - recipe[osl-app::app1]
  - name: app2
    attributes:
      users:
        - formsender-staging
        - formsender-production
        - iam-staging
        - iam-production
        - timesync-production
        - timesync-staging
    run_list:
      - recipe[sudo]
      - recipe[user::data_bag]
      - recipe[osl-app::app2]
  - name: app3
    attributes:
      osl-mysql:
        enable_percona_client: true
      percona:
        encrypted_data_bag: percona
        encrypted_data_bag_secret_file: "/etc/chef/encrypted_data_bag_secret"
      users:
        - streamwebs-staging
        - streamwebs-production
        - timesync-web-staging
        - timesync-web-production
    run_list:
      - recipe[sudo]
      - recipe[user::data_bag]
      - recipe[app_test::app3]
      - recipe[osl-app::app3]
      - recipe[app_test::app3_postrun]
    driver:
      name: openstack
      flavor_ref: 'm1.large'
